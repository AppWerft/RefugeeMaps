function capitalize(e){return e[0].toUpperCase()+e.slice(1)}var Map=require("ti.map"),Adapter=require("adapters/refmaps"),Refresher=require("com.rkam.swiperefreshlayout");module.exports=function(){var e=Ti.UI.createWindow({title:"RefugeeMaps for Hamburg",exitOnClose:!0,backgroundColor:"white"});e.map=Map.createView({region:{latitude:53.553,longitude:10,latitudeDelta:.1,longitudeDelta:.1},enableZoomControls:!1,compassEnabled:!1,userLocation:!0,userLocationButton:!1}),e.list=Ti.UI.createView({top:50}),e.list.add(Refresher.createSwipeRefresh({view:Ti.UI.createTableView({top:50}),dummy:"xyz",top:50})),e.add(Ti.UI.createScrollableView({views:[e.map,e.list]})),Adapter.getPOIs(function(a){e.markerdata=a.markers,e.categorydata=a.categories,e.map.addAnnotations(e.markerdata.map(function(e){return Map.createAnnotation({latitude:e.position.lat,longitude:e.position.lng,title:e.name,subtitle:e.translations[0].text,image:"/images/"+e.category+".png"})})),Adapter.sortByDistanceToOwnPosition(e.markerdata,function(a){e.list.children[0].view.setData(a.map(require("ui/row")))},function(a){e.children[1].children[2].text="Your position:\n"+a.street+" "+a.street_number}),e.drawer.removeAllChildren();for(var t in e.categorydata){var n=e.categorydata[t],r=Ti.UI.createView({top:5,height:40});r.add(Ti.UI.createSwitch({right:10,width:Ti.UI.SIZE,value:n[t]||!0,key:t,top:5,height:Ti.UI.SIZE})),r.add(Ti.UI.createImageView({top:5,touchEnabled:!1,left:5,width:20,height:25,image:"/assets/"+t+".png"})),r.add(Ti.UI.createLabel({top:5,height:Ti.UI.SIZE,left:30,color:"#444",touchEnabled:!1,text:capitalize(t)})),e.drawer.add(r)}}),e.add(Ti.UI.createView({top:0,height:50,backgroundColor:"#6000"})),e.children[1].add(Ti.UI.createButton({backgroundImage:"/assets/list.png",width:50,height:50,right:10})),e.children[1].add(Ti.UI.createButton({backgroundImage:"/assets/filter.png",width:50,height:50,right:60})),e.children[1].add(Ti.UI.createLabel({width:Ti.UI.FILL,color:"white",text:"Your position:\nunknown",font:{fontWeight:"bold"},height:Ti.UI.FILL,left:10})),e.drawer=Ti.UI.createScrollView({layout:"vertical",scrollType:"vertical",top:50,backgroundColor:"white",left:-200,width:200,height:Ti.UI.FILL,opacity:.96}),e.add(e.drawer),e.drawer.addEventListener("swipe",function(a){("left"==a.direction||"right"==a.direction)&&e.drawer.animate({left:-200,duration:100})}),e.drawer.addEventListener("change",function(e){console.log(e.source.key+"="+e.source.value);var a=Ti.App.Properties.getObject("MARKERCATEGORIES",{});console.log(a),a[e.source.key]=e.source.value,console.log(a),Ti.App.Properties.setObject("MARKERCATEGORIES",a)}),e.children[0].addEventListener("scrollend",function(a){e.children[1].children[0].backgroundImage=0==a.source.currentPage?"/assets/list.png":"/assets/map.png"}),e.children[1].children[0].addEventListener("singletap",function(a){0==e.children[0].currentPage?(e.drawer.animate({left:-200,duration:100}),e.children[0].scrollToView(1)):e.children[0].scrollToView(0)}),e.children[1].children[1].addEventListener("singletap",function(a){0==e.drawer.left?e.drawer.animate({left:-200,duration:100}):(e.children[0].scrollToView(0),e.drawer.animate({left:0,duration:100}))}),e.list.children[0].addEventListener("refreshing",function(){Adapter.sortByDistanceToOwnPosition(e.markerdata,function(a){e.list.children[0].setRefreshing(!1),e.list.children[0].view.setData(a.map(require("ui/row")))},function(a){e.children[1].children[2].text="Your position:\n"+a.street+" "+a.street_number}),setTimeout(function(){e.list.children[0].setRefreshing(!1)},1e4)}),e.addEventListener("open",function(){e.activity.actionBar.hide(),require("vendor/versionsreminder")()}),e.addEventListener("android:back",function(e){e.cancelBubble=!0;var a=Ti.Android.createIntent({action:Ti.Android.ACTION_MAIN,flags:Ti.Android.FLAG_ACTIVITY_NEW_TASK});return a.addCategory(Ti.Android.CATEGORY_HOME),Ti.Android.currentActivity.startActivity(a),!1}),Ti.Gesture.addEventListener("orientationchange",function(){e.children[1]&&e.children[1].setTop(Ti.Platform.displayCaps.platformHeight>Ti.Platform.displayCaps.platformWidth?0:-50)}),e.open()};