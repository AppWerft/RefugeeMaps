var Map=require("ti.map"),Adapter=require("adapters/refmaps"),Refresher=require("com.rkam.swiperefreshlayout");module.exports=function(){var e=Ti.UI.createWindow({title:"RefugeeMaps for Hamburg",exitOnClose:!0,backgroundColor:"white",theme:"Theme.NoActionBar"});e.addEventListener("open",function(){e.activity.actionBar.hide(),e.map=Map.createView({region:{latitude:53.553,longitude:10,latitudeDelta:.1,longitudeDelta:.1},enableZoomControls:!1,compassEnabled:!1,userLocation:!0,userLocationButton:!1}),e.list=Ti.UI.createView({top:50}),e.list.add(Refresher.createSwipeRefresh({view:Ti.UI.createTableView({top:50}),top:50})),e.add(Ti.UI.createScrollableView({views:[e.map,e.list]})),Adapter.getPOIs(function(a){e.markerdata=a,e.map.addAnnotations(a.map(function(e){return Map.createAnnotation({latitude:e.position.lat,longitude:e.position.lng,title:e.name,subtitle:e.translations[0].text,image:"/images/"+e.category+".png"})})),Adapter.sortByDistanceToOwnPosition(a,function(a){e.list.children[0].view.setData(a.map(require("ui/row")))})}),e.add(Ti.UI.createView({top:0,height:50,backgroundColor:"#6000"})),e.children[1].add(Ti.UI.createButton({backgroundImage:"/assets/list.png",width:30,height:30,right:10})),e.children[1].add(Ti.UI.createButton({backgroundImage:"/assets/filter.png",width:30,height:30,right:70})),e.children[1].children[0].addEventListener("click",function(){e.children[0].scrollToView(0==e.children[0].currentPage?1:0)}),e.children[0].addEventListener("scrollend",function(a){e.children[1].children[0].backgroundImage=0==a.source.currentPage?"/assets/list.png":"/assets/map.png"}),e.children[1].children[0].addEventListener("refresh",function(){Adapter.sortByDistanceToOwnPosition(e.markerdata,function(a){e.list.children[0].view.setData(a.map(require("ui/row"))),e.list.children[0].setRefreshing(!1)})})}),e.addEventListener("android:back",function(e){e.cancelBubble=!0;var a=Ti.Android.createIntent({action:Ti.Android.ACTION_MAIN,flags:Ti.Android.FLAG_ACTIVITY_NEW_TASK});return a.addCategory(Ti.Android.CATEGORY_HOME),Ti.Android.currentActivity.startActivity(a),!1}),Ti.Gesture.addEventListener("orientationchange",function(){e.children[1]&&e.children[1].setTop(Ti.Platform.displayCaps.platformHeight>Ti.Platform.displayCaps.platformWidth?0:-50)}),e.open(),require("vendor/versionsreminder")()};